```{r}
if (!require("pacman")) install.packages("pacman")
pacman::p_load(tidyverse, here, WDI)
```

# World Bank Development Indicators

```{r}
as_tibble(WDIsearch("population")) %>% print(n = Inf)
```

## (a) Extraction functions

#### Search parameters

```{r}
search <- function(country) {
  data <- WDI(
    indicator = c(
      gdp = "NY.GDP.MKTP.CD", # (current US$)
      gdp_pcap = "NY.GDP.PCAP.CD", # (current US$)
      population = "SP.POP.TOTL"
    ),
    country = country,
    start = 1995,
    end = 2020,
    extra = TRUE
  ) %>% 
    as_tibble()
}
```

#### Export as .rds

```{r}
write <-
  function(data) {
    name <- deparse(substitute(data))
    write_rds(data, file = paste0(here("Data", "World Bank raw"), "/", name, ".rds"))
  }
```

## (b) Data extraction

#### List of countries in the main dataset

```{r}
countries <- 
  read_rds("https://github.com/gafnts/gravity-model/blob/main/Data/Main%20data%20frames/countries.rds?raw=true") %>% 
  filter(!partner_iso %in% "GUF") %>% 
  pull(partner_iso) 
```

#### Extraction

```{r}
worldbank <- search(countries)
write(worldbank)
```
